<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RVCE 2022 Scheme Grade & SGPA Calculator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

        :root {
            --primary-color: #0d47a1; --secondary-color: #1976d2; --accent-color: #64b5f6;
            --text-color: #212121; --bg-color: #f5f7fa; --card-bg: rgba(255, 255, 255, 0.7);
            --border-color: rgba(200, 200, 200, 0.5); --shadow-color: rgba(0, 0, 0, 0.1);
            --success-color: #2e7d32; --danger-color: #c62828;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #e0f2f1 0%, #b2ebf2 100%);
            color: var(--text-color); padding: 20px; line-height: 1.6;
        }
        
        .container { max-width: 1400px; margin: 0 auto; }

        header {
            text-align: center; margin-bottom: 40px; padding: 20px; color: white;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 12px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }
        
        header h1 { font-weight: 700; font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
        header p { font-size: 1.1em; opacity: 0.9; }

        .main-controls, #globalELContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-color);
            border: 1px solid var(--border-color);
        }

        .main-controls label, #globalELContainer label { font-weight: 600; font-size: 1.2em; color: var(--primary-color); }
        
        .main-controls select, #globalELContainer input {
            padding: 12px 18px; font-size: 1.1em; font-family: 'Poppins', sans-serif;
            border-radius: 8px; border: 1px solid var(--border-color); background-color: #fff;
            transition: all 0.3s ease;
        }

        .main-controls select:focus, #globalELContainer input:focus {
            outline: none; border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(100, 181, 246, 0.4);
        }
        
        .subjects-container {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px; padding-bottom: 120px; /* Space for sticky footer */
        }
        
        .subject-card {
            background: var(--card-bg); backdrop-filter: blur(10px);
            border: 1px solid var(--border-color); border-radius: 12px;
            box-shadow: 0 4px 20px var(--shadow-color); padding: 20px; transition: all 0.3s ease;
        }
        
        .subject-card:hover { transform: translateY(-8px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white; padding: 15px 20px; margin: -20px -20px 20px -20px;
            border-top-left-radius: 12px; border-top-right-radius: 12px;
        }
        .card-header h3 { font-size: 1.3em; font-weight: 600; }
        .card-header p { font-size: 0.9em; opacity: 0.9; margin-top: 4px;}
        .input-group { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .input-group label { font-weight: 500; }
        .input-group input {
            width: 100px; padding: 8px; border-radius: 6px; text-align: right;
            border: 1px solid var(--border-color); font-family: 'Poppins', sans-serif;
            transition: all 0.2s ease;
        }
        .input-group input:focus {
            outline: none; border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(100, 181, 246, 0.4);
        }
        
        .section-title {
            font-weight: 600; font-size: 1.1em; color: var(--primary-color);
            margin-top: 25px; margin-bottom: 15px; padding-bottom: 8px;
            border-bottom: 2px solid var(--accent-color);
        }
        
        .cie-sub-group { border-left: 3px solid var(--accent-color); padding-left: 15px; margin: 15px 0; }
        
        .output-display {
            background: #e3f2fd; padding: 15px; border-radius: 8px;
            margin-top: 20px; text-align: center; border: 1px solid var(--accent-color);
        }
        
        .output-display .final-grade { font-size: 2em; font-weight: 700; }
        .pass { color: var(--success-color); }
        .fail { color: var(--danger-color); }
        .not-possible { color: #9e9e9e; font-style: italic; font-size: 0.9em; }

        .see-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .see-table th, .see-table td { border: 1px solid var(--border-color); padding: 10px; text-align: center; }
        .see-table th { background-color: #e3f2fd; font-weight: 600; }
        .grade-O, .grade-A-plus, .grade-A { background-color: #e8f5e9; }
        .grade-B-plus, .grade-B { background-color: #fffde7; }
        .grade-C, .grade-P { background-color: #fff3e0; }

        .sgpa-footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);
            padding: 15px; display: flex; justify-content: center; align-items: center;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1); border-top: 1px solid var(--border-color);
            z-index: 1000;
        }
        
        #calculateSGPABtn {
            padding: 15px 40px; font-size: 1.3em; font-weight: 600;
            background: linear-gradient(135deg, #43a047, #66bb6a);
            color: white; border: none; border-radius: 8px; cursor: pointer;
            transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }
        
        #calculateSGPABtn:hover { transform: translateY(-3px); box-shadow: 0 7px 20px rgba(46, 125, 50, 0.4); }
        #sgpaResult { font-size: 1.5em; font-weight: 600; margin-left: 20px; }
        #sgpaResult span { color: var(--primary-color); font-size: 1.6em; font-weight: 700;}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>RVCE Grade & SGPA Calculator</h1>
            <p>Your Ultimate Guide to First-Year Grades</p>
        </header>

        <div class="main-controls">
            <label for="cycleSelect">Select Your Academic Cycle:</label>
            <select id="cycleSelect">
                <option value="">-- Choose Your Academic Cycle --</option>
                <option value="chemistry">Chemistry Cycle</option>
                <option value="physics">Physics Cycle</option>
            </select>
        </div>

        <div id="globalELContainer" style="display:none;">
            <label for="globalELInput">EL Score (of 100):</label>
            <input type="number" id="globalELInput" min="0" max="100" placeholder="e.g., 85">
        </div>

        <div class="subjects-container" id="subjectsContainer"></div>
    </div>
    
    <div class="sgpa-footer" id="sgpaFooter" style="display:none;">
        <button id="calculateSGPABtn">Calculate SGPA</button>
        <div id="sgpaResult"></div>
    </div>

    <script>
        // *** FIX: Wrap all JavaScript in DOMContentLoaded event listener ***
        document.addEventListener('DOMContentLoaded', function() {
            const courseData = {
                chemistry: [
                    { id: 'MA211TC', name: 'Mathematics', credits: 4, type: 'Theory-Math' },
                    { id: 'CM211IA', name: 'Chemistry', credits: 4, type: 'Theory+Lab' },
                    { id: 'ME112GL', name: 'Engg. Graphics (CAEG)', credits: 3, type: 'CAEG' },
                    { id: 'HS115YL_C', name: 'Health-Yoga Practice', credits: 1, type: 'Yoga' },
                    { id: 'HS114TC', name: 'Indian Constitution', credits: 1, type: 'TypeC' },
                    { id: 'HS111EL', name: 'Communicative English-I', credits: 1, type: 'English'},
                    { id: 'ESC_C', name: 'Engineering Science Course (ESC)', credits: 3, type: 'Theory' },
                    { id: 'XX115XIX', name: 'Programming Languages Course (PLC)', credits: 3, type: 'Theory+Lab' }
                ],
                physics: [
                    { id: 'MA211TB', name: 'Mathematics', credits: 4, type: 'Theory-Math' },
                    { id: 'PY211IB', name: 'Physics', credits: 4, type: 'Theory+Lab' },
                    { id: 'HS112KS', name: 'Kannada', credits: 1, type: 'TypeC' },
                    { id: 'ME111DL', name: 'IDEA Lab', credits: 1, type: 'IDEALab' },
                    { id: 'HS111EL_P', name: 'Communicative English-I', credits: 1, type: 'English'},
                    { id: 'ESC_P', name: 'Engineering Science Course (ESC)', credits: 3, type: 'Theory' },
                    { id: 'ETC_P', name: 'Emerging Technology Course (ETC)', credits: 3, type: 'Theory' },
                    { id: 'CS222IA_P', name: 'Professional Core Course (PPC)', credits: 3, type: 'Theory+Lab' }
                ]
            };
            const gradePoints = { O: 10, 'A+': 9, A: 8, 'B+': 7, B: 6, C: 5, P: 4, F: 0 };
            const gradeThresholds = { O: 90, 'A+': 80, A: 70, 'B+': 60, B: 55, C: 50, P: 40 };

            document.getElementById('cycleSelect').addEventListener('change', loadCycleContent);
            document.getElementById('calculateSGPABtn').addEventListener('click', calculateSGPA);
            document.getElementById('globalELInput').addEventListener('input', (e) => {
                validateInput(e);
                distributeGlobalEL();
            });

            function loadCycleContent() {
                const container = document.getElementById('subjectsContainer');
                container.innerHTML = '';
                document.getElementById('sgpaResult').innerHTML = '';
                document.getElementById('globalELInput').value = '';
                const selectedCycle = document.getElementById('cycleSelect').value;
                const globalELContainer = document.getElementById('globalELContainer');
                const sgpaFooter = document.getElementById('sgpaFooter');
                if (!selectedCycle) {
                    sgpaFooter.style.display = 'none';
                    globalELContainer.style.display = 'none';
                    return;
                }
                courseData[selectedCycle].forEach(subject => container.appendChild(createSubjectCard(subject)));
                sgpaFooter.style.display = 'flex';
                globalELContainer.style.display = 'flex';
                addEventListeners();
            }
            
            function addEventListeners() {
                document.querySelectorAll('.cie-input, .see-input').forEach(input => {
                    input.addEventListener('input', (e) => {
                        validateInput(e);
                        const card = e.target.closest('.subject-card');
                        if (card) updateAllCalculations(card.dataset.subjectId);
                    });
                });
            }
            
            function validateInput(e) {
                const target = e.target;
                const value = parseFloat(target.value);
                const max = parseFloat(target.getAttribute('max'));
                const min = parseFloat(target.getAttribute('min'));
                if (value > max) {
                    alert(`Invalid Entry. Maximum marks allowed is ${max}.`);
                    target.value = '';
                }
                if (value < min) {
                    alert(`Invalid Entry. Minimum marks allowed is ${min}.`);
                    target.value = '';
                }
            }

            function createSubjectCard(subject) {
                const card = document.createElement('div');
                card.className = 'subject-card';
                card.id = `card-${subject.id}`;
                card.dataset.subjectId = subject.id;
                card.dataset.credits = subject.credits;
                card.dataset.type = subject.type;

                const quizHTML = (max, qmax) => `<div class="cie-sub-group"><strong>Quizzes (Total ${max})</strong><div class="input-group"><label>Quiz 1 (of ${qmax})</label><input type="number" class="cie-input" data-field="quiz1" min="0" max="${qmax}"></div><div class="input-group"><label>Quiz 2 (of ${qmax})</label><input type="number" class="cie-input" data-field="quiz2" min="0" max="${qmax}"></div></div>`;
                const testHTML = `<div class="cie-sub-group"><strong>Tests</strong><div class="input-group"><label>Test 1 (of 50)</label><input type="number" class="cie-input" data-field="test1" min="0" max="50"></div><div class="input-group"><label>Test 2 (of 50)</label><input type="number" class="cie-input" data-field="test2" min="0" max="50"></div></div>`;
                
                let cieInputsHTML = '', seeInputHTML = '', cieMax = 100;

                switch (subject.type) {
                    case 'Theory': case 'Theory+Lab': case 'Theory-Math':
                        cieInputsHTML = quizHTML(subject.type === 'Theory+Lab' ? 10 : 20, 10) + testHTML;
                        if (subject.type === 'Theory') cieInputsHTML += `<div class="input-group"><label>EL (Max 40)</label><input type="number" class="cie-input" data-field="el" min="0" max="40"></div>`;
                        else if (subject.type === 'Theory-Math') cieInputsHTML += `<div class="input-group"><label>EL (Max 20)</label><input type="number" class="cie-input" data-field="el" min="0" max="20"></div><div class="input-group"><label>MATLAB (Max 20)</label><input type="number" class="cie-input" data-field="matlab" min="0" max="20"></div>`;
                        else cieInputsHTML += `<div class="input-group"><label>EL (Max 30)</label><input type="number" class="cie-input" data-field="el" min="0" max="30"></div><div class="input-group"><label>Lab (Max 30)</label><input type="number" class="cie-input" data-field="lab" min="0" max="30"></div>`;
                        seeInputHTML = `<div class="input-group"><label>SEE Score (of 100)</label><input type="number" class="see-input" min="0" max="100"></div>`;
                        break;
                    case 'Lab':
                        cieInputsHTML = `<div class="input-group"><label>Total CIE (of 100)</label><input type="number" class="cie-input" data-field="cie_total" min="0" max="100"></div>`;
                        seeInputHTML = `<div class="input-group" style="display:none;"><input class="see-input"></div>`;
                        break;
                    case 'IDEALab': case 'Yoga': case 'English': case 'TypeC': case 'CAEG':
                        cieMax = 50;
                        seeInputHTML = `<div class="input-group"><label>SEE Score (of 50)</label><input type="number" class="see-input" min="0" max="50"></div>`;
                        if(subject.type === 'IDEALab') cieInputsHTML = `<div class="input-group"><label>Total CIE (of 50)</label><input type="number" class="cie-input" data-field="cie_total" min="0" max="50"></div>`;
                        if(subject.type === 'Yoga') cieInputsHTML = `<div class="input-group"><label>Practice + Writing (of 50)</label><input type="number" class="cie-input" data-field="practice" min="0" max="50"></div><div class="input-group"><label>EL (Max 10)</label><input type="number" class="cie-input" data-field="el_yoga" min="0" max="10"></div>`;
                        if(subject.type === 'English') cieInputsHTML = testHTML + `<div class="input-group"><label>Written/Oral EL (Max 5)</label><input type="number" class="cie-input" data-field="el_eng" min="0" max="5"></div><div class="input-group"><label>STEP Module (Max 5)</label><input type="number" class="cie-input" data-field="step" min="0" max="5"></div>`;
                        if(subject.type === 'TypeC') cieInputsHTML = quizHTML(10, 10) + testHTML + `<div class="input-group"><label>EL (Max 20)</label><input type="number" class="cie-input" data-field="el_typec" min="0" max="20"></div>`;
                        if(subject.type === 'CAEG') cieInputsHTML = `<div class="input-group"><label>Sketchbook (of 50)</label><input type="number" class="cie-input" data-field="sketchbook" min="0" max="50"></div><div class="input-group"><label>CAEG EL (Max 10)</label><input type="number" class="cie-input" data-field="el_caeg" min="0" max="10"></div>` + testHTML;
                        break;
                }
                card.innerHTML = `<div class="card-header"><h3>${subject.name}</h3><p>Credits: ${subject.credits}</p></div><div class="card-body"><div class="section-title">CIE Marks</div>${cieInputsHTML}<div class="section-title">SEE Marks</div>${seeInputHTML}<div class="output-display" id="output-${subject.id}"><div>Total CIE: <span class="cie-total">0</span>/${cieMax}</div><div>Final Grade: <span class="final-grade">--</span></div><div>Status: <span class="status">--</span></div></div><div class="section-title">SEE Marks Required for Grades</div><table class="see-table"><thead><tr><th>Grade</th><th>O</th><th>A+</th><th>A</th><th>B+</th><th>B</th><th>C</th><th>P</th></tr></thead><tbody><tr id="see-req-${subject.id}"></tr></tbody></table></div>`;
                return card;
            }

            function updateAllCalculations(subjectId) {
                const card = document.getElementById(`card-${subjectId}`);
                if (!card) return;
                const totalCIE = calculateCIE(subjectId);
                card.querySelector('.cie-total').textContent = totalCIE.toFixed(2);
                card.dataset.cie = totalCIE;
                calculateSEERequired(subjectId, totalCIE);
                calculateFinalGrade(subjectId, totalCIE);
            }

            function calculateCIE(subjectId) {
                const card = document.getElementById(`card-${subjectId}`);
                const type = card.dataset.type;
                const getVal = (field) => Number(card.querySelector(`[data-field="${field}"]`)?.value) || 0;
                let totalCIE = 0;
                const testSum = getVal('test1') + getVal('test2');

                switch(type) {
                    case 'Lab': case 'IDEALab': return getVal('cie_total');
                    case 'CAEG':
                        totalCIE = Math.ceil(getVal('sketchbook') / 50 * 25) + getVal('el_caeg') + Math.ceil(testSum / 100 * 15);
                        return Math.min(50, totalCIE);
                    case 'Yoga':
                        return Math.min(50, Math.ceil(getVal('practice') / 50 * 40) + getVal('el_yoga'));
                    case 'TypeC':
                        totalCIE = Math.ceil((getVal('quiz1') + getVal('quiz2')) / 20 * 10) + Math.ceil(testSum / 100 * 20) + getVal('el_typec');
                        return Math.min(50, totalCIE);
                    case 'English':
                         totalCIE = Math.ceil(testSum / 100 * 40) + getVal('el_eng') + getVal('step');
                         return Math.min(50, totalCIE);
                    default:
                        totalCIE += Math.ceil((type === 'Theory+Lab') ? (getVal('quiz1') + getVal('quiz2')) / 2 : (getVal('quiz1') + getVal('quiz2')));
                        totalCIE += Math.ceil(testSum * ((type === 'Theory+Lab' ? 30 : 40) / 100));
                        if (type === 'Theory' || type === 'Theory-Math' || type === 'Theory+Lab') totalCIE += getVal('el');
                        if (type === 'Theory-Math') totalCIE += getVal('matlab');
                        if (type === 'Theory+Lab') totalCIE += getVal('lab');
                        return Math.min(100, totalCIE);
                }
            }

            function calculateSEERequired(subjectId, totalCIE) {
                const row = document.getElementById(`see-req-${subjectId}`);
                const type = document.getElementById(`card-${subjectId}`).dataset.type;
                if (type === 'Lab') { row.innerHTML = `<td colspan="8">Not Applicable</td>`; return; }

                let content = `<td>SEE Marks</td>`;
                const is50MarkSEE = ['CAEG', 'TypeC', 'IDEALab', 'Yoga', 'English'].includes(type);
                const seeMax = is50MarkSEE ? 50 : 100;
                const seeMin = is50MarkSEE ? 20 : 40;

                for (const grade in gradeThresholds) {
                    const requiredSEE = is50MarkSEE ? (gradeThresholds[grade] - totalCIE) : (gradeThresholds[grade] * 2) - totalCIE;
                    const displayVal = (requiredSEE > seeMax || requiredSEE < seeMin) ? `<span class="not-possible">N/A</span>` : Math.ceil(requiredSEE);
                    content += `<td>${displayVal}</td>`;
                }
                row.innerHTML = content;
            }

            function calculateFinalGrade(subjectId, totalCIE) {
                const card = document.getElementById(`card-${subjectId}`);
                const finalGradeSpan = card.querySelector('.final-grade');
                const statusSpan = card.querySelector('.status');
                const type = card.dataset.type;

                finalGradeSpan.textContent = '--'; statusSpan.textContent = '--';
                statusSpan.className = 'status'; card.dataset.gradePoint = '';

                if (type === 'Lab') {
                    let grade = 'F', status = 'Fail';
                    if (totalCIE >= 40) {
                        for (const g in gradeThresholds) { if (totalCIE >= gradeThresholds[g]) { grade = g; break; } }
                        status = 'Pass';
                    }
                    finalGradeSpan.textContent = grade; statusSpan.textContent = status;
                    statusSpan.classList.add(status.toLowerCase()); card.dataset.gradePoint = gradePoints[grade];
                    return;
                }
                
                const seeInput = card.querySelector('.see-input');
                if (!seeInput.value) return;
                const seeMark = Number(seeInput.value);
                const is50MarkSEE = ['CAEG', 'TypeC', 'IDEALab', 'Yoga', 'English'].includes(type);
                const seeMin = is50MarkSEE ? 20 : 40;
                
                if (seeMark < seeMin) {
                    finalGradeSpan.textContent = 'F'; statusSpan.textContent = `Fail (SEE < ${seeMin})`;
                    statusSpan.classList.add('fail'); card.dataset.gradePoint = 0; return;
                }

                const finalMark = is50MarkSEE ? totalCIE + seeMark : (totalCIE + seeMark) / 2;
                if (finalMark < 40) {
                    finalGradeSpan.textContent = 'F'; statusSpan.textContent = 'Fail (Total < 40)';
                    statusSpan.classList.add('fail'); card.dataset.gradePoint = 0; return;
                }
                
                let grade = 'P';
                for (const g in gradeThresholds) { if (finalMark >= gradeThresholds[g]) { grade = g; break; } }
                
                finalGradeSpan.textContent = grade; statusSpan.textContent = 'Pass';
                statusSpan.classList.add('pass'); card.dataset.gradePoint = gradePoints[grade];
            }
            
            function distributeGlobalEL() {
                const globalELMark = Number(document.getElementById('globalELInput').value) || 0;
                document.querySelectorAll('.subject-card').forEach(card => {
                    const type = card.dataset.type;
                    const ineligibleTypes = ['Lab', 'IDEALab', 'Yoga', 'English', 'TypeC', 'CAEG'];
                    if (ineligibleTypes.includes(type)) return;

                    const elInput = card.querySelector('[data-field="el"]');
                    if (!elInput) return;
                    
                    let weightage = 0;
                    if (type === 'Theory+Lab') weightage = 30;
                    else if (type === 'Theory') weightage = 40;
                    else if (type === 'Theory-Math') weightage = 20;

                    if (weightage > 0) {
                        const scaledEL = Math.ceil(globalELMark * (weightage / 100));
                        elInput.value = Math.min(weightage, scaledEL);
                        elInput.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                });
            }

            function calculateSGPA() {
                const cards = document.querySelectorAll('.subject-card');
                let totalCredits = 0, weightedGradePoints = 0, allGradesEntered = true;
                if (cards.length === 0) return;
                
                cards.forEach(card => {
                    const credits = Number(card.dataset.credits);
                    const gp = card.dataset.gradePoint;
                    if (gp === '' || gp === undefined) allGradesEntered = false;
                    totalCredits += credits;
                    weightedGradePoints += credits * (Number(gp) || 0);
                });
                
                const resultDiv = document.getElementById('sgpaResult');
                if (!allGradesEntered) {
                    resultDiv.innerHTML = '<span class="fail">Please enter all CIE & SEE marks for an accurate SGPA.</span>';
                    return;
                }
                if (totalCredits === 0) { resultDiv.innerHTML = ''; return; }
                
                const sgpa = weightedGradePoints / totalCredits;
                resultDiv.innerHTML = `Your Calculated SGPA is: <span>${sgpa.toFixed(2)}</span>`;
            }

        }); // End of DOMContentLoaded
    </script>
</body>
</html>